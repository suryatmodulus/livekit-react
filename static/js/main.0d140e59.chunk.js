(this["webpackJsonplivekit-react-example"]=this["webpackJsonplivekit-react-example"]||[]).push([[0],{145:function(e,t,n){},147:function(e,t,n){"use strict";n.r(t);var a=n(59),r=n.n(a),i=(n(90),n(44)),c=n(8),o=n(37),s=n(13),l=n(5),u=n.n(l),d=n(11),v=n(2),m=n(0),p=n.n(m),h=n(38),b=n(80),f=n(82),j=n(81),g=function(e){var t=e.track,n=e.isLocal,a=Object(m.useRef)();return Object(m.useEffect)((function(){if(!n)return a.current=t.attach(),t.sid&&a.current.setAttribute("data-audio-track-id",t.sid),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t,n]),null},k={video:"_2WNzJ",participant:"_34YL4",speaker:"_1y2fW",placeholder:"_30KSQ",participantBar:"_2LCHl",name:"_55u8f",center:"_213aF",stats:"_te685",screenShare:"_1FIqv",iconRed:"_3LzZj",controlsWrapper:"_2kKks",buttonWrapper:"_3w3nM",button:"_hRq5k",icon:"_1Nxni",dangerButton:"_Rt0RH",dropdown:"_3Lz0y",hasDropdown:"_3Bgvz",separator:"_1VLMM",popoverMenu:"_3XXS4",list:"_dKNN7",container:"_14898",overlay:"_17KXW",unmuteButton:"_3QhLc"},E=function(e){var t=e.label,n=e.disabled,a=e.onClick,r=e.icon,i=e.className,c=e.menuItems,o=e.popoverContainerClassName,s=e.popoverTriggerBtnClassName,l=e.popoverTriggerBtnSeparatorClassName,u=e.onMenuItemClick,v=Object(m.useState)(!1),f=v[0],j=v[1],g=k.button;i&&(g+=" "+i);var E,O=p.a.createElement("div",null);c&&c.length>0&&(g+=" "+k.hasDropdown,E=p.a.createElement("button",{disabled:n,className:k.button+" "+s+"  "+k.dropdown,onClick:function(){return j(!f)}},p.a.createElement("div",{className:k.separator+" "+l}),p.a.createElement(h.a,{height:32,icon:d.b})),O=p.a.createElement("div",{className:k.popoverMenu+" "+o},p.a.createElement("ul",{className:k.list},null===c||void 0===c?void 0:c.map((function(e,t){return p.a.createElement("li",{key:t,onClick:function(){return function(e){j(!1),u&&u(e)}(e)}},e.label)})))));var S=p.a.createElement("button",{disabled:n,className:g,onClick:function(){j(!1),a&&a()}},r&&p.a.createElement(h.a,{className:k.icon,height:32,icon:r}),t);return E?p.a.createElement(b.Popover,{isOpen:f,positions:["top"],content:O},p.a.createElement("div",{className:k.buttonWrapper},S,E)):S},O=function(e){var t=e.isMuted,n=e.onClick,a=e.onSourceSelected,r=e.isButtonDisabled,i=e.muteText,c=void 0===i?"Mute":i,o=e.unmuteText,s=void 0===o?"Unmute":o,l=e.className,u=e.popoverContainerClassName,h=e.popoverTriggerBtnClassName,b=e.popoverTriggerBtnSeparatorClassName,f=Object(m.useState)([]),j=f[0],g=f[1],k=Object(m.useState)([]),O=k[0],S=k[1],y=Object(m.useCallback)((function(){try{return Promise.resolve(v.Room.getLocalDevices("audioinput")).then((function(e){g(e),S(e.map((function(e){return{label:e.label}})))}))}catch(e){return Promise.reject(e)}}),[]);Object(m.useEffect)((function(){return y(),navigator.mediaDevices.addEventListener("devicechange",y),function(){navigator.mediaDevices.removeEventListener("devicechange",y)}}),[]);return p.a.createElement(E,{label:t?s:c,icon:t?d.e:d.d,disabled:r,onClick:n,menuItems:O,onMenuItemClick:function(e){var t=j.find((function(t){return t.label===e.label}));t&&a&&a(t)},className:l,popoverContainerClassName:u,popoverTriggerBtnClassName:h,popoverTriggerBtnSeparatorClassName:b})};function S(e){var t,n=Object(m.useState)(!1),a=n[0],r=n[1],i=Object(m.useState)(!1)[1],c=Object(m.useState)(e.connectionQuality),o=c[0],s=c[1],l=Object(m.useState)(!1),u=l[0],d=l[1],p=Object(m.useState)(),h=p[0],b=p[1],f=Object(m.useState)([]),j=f[0],g=f[1],k=Object(m.useState)([]),E=k[0],O=k[1],S=function(){g(Array.from(e.tracks.values())),O(Array.from(e.tracks.values()).filter((function(e){return e.isSubscribed&&void 0!==e.track})))};return Object(m.useEffect)((function(){var t=function(e){e.kind===v.Track.Kind.Audio?r(!0):e.kind===v.Track.Kind.Video&&i(!0)},n=function(e){e.kind===v.Track.Kind.Audio?r(!1):e.kind===v.Track.Kind.Video&&i(!1)},a=function(){e.metadata&&b(e.metadata)},c=function(){d(e.isSpeaking)},o=function(){s(e.connectionQuality)};return e.on(v.ParticipantEvent.TrackMuted,t).on(v.ParticipantEvent.TrackUnmuted,n).on(v.ParticipantEvent.ParticipantMetadataChanged,a).on(v.ParticipantEvent.IsSpeakingChanged,c).on(v.ParticipantEvent.TrackPublished,S).on(v.ParticipantEvent.TrackUnpublished,S).on(v.ParticipantEvent.TrackSubscribed,S).on(v.ParticipantEvent.TrackUnsubscribed,S).on(v.ParticipantEvent.LocalTrackPublished,S).on(v.ParticipantEvent.LocalTrackUnpublished,S).on(v.ParticipantEvent.ConnectionQualityChanged,o),a(),c(),S(),function(){e.off(v.ParticipantEvent.TrackMuted,t).off(v.ParticipantEvent.TrackUnmuted,n).off(v.ParticipantEvent.ParticipantMetadataChanged,a).off(v.ParticipantEvent.IsSpeakingChanged,c).off(v.ParticipantEvent.TrackPublished,S).off(v.ParticipantEvent.TrackUnpublished,S).off(v.ParticipantEvent.TrackSubscribed,S).off(v.ParticipantEvent.TrackUnsubscribed,S).off(v.ParticipantEvent.LocalTrackPublished,S).off(v.ParticipantEvent.LocalTrackUnpublished,S).off(v.ParticipantEvent.ConnectionQualityChanged,o)}}),[e]),e.audioTracks.forEach((function(e){t=e.isMuted})),void 0===t&&(t=!0),a!==t&&r(t),{isLocal:e instanceof v.LocalParticipant,isSpeaking:u,connectionQuality:o,publications:j,subscribedTracks:E,cameraPublication:e.getTrack(v.Track.Source.Camera),microphonePublication:e.getTrack(v.Track.Source.Microphone),screenSharePublication:e.getTrack(v.Track.Source.ScreenShare),metadata:h}}var y,x,C,P,T,N=function(e){var t=e.isEnabled,n=e.onClick,a=e.onSourceSelected,r=e.disableText,i=void 0===r?"Disable Video":r,c=e.enableText,o=void 0===c?"Enable Video":c,s=e.className,l=e.isButtonDisabled,u=e.popoverContainerClassName,h=e.popoverTriggerBtnClassName,b=e.popoverTriggerBtnSeparatorClassName,f=Object(m.useState)([]),j=f[0],g=f[1],k=Object(m.useState)([]),O=k[0],S=k[1],y=Object(m.useCallback)((function(){try{return Promise.resolve(v.Room.getLocalDevices("videoinput")).then((function(e){g(e),S(e.map((function(e){return{label:e.label}})))}))}catch(e){return Promise.reject(e)}}),[]);Object(m.useEffect)((function(){return y(),navigator.mediaDevices.addEventListener("devicechange",y),function(){navigator.mediaDevices.removeEventListener("devicechange",y)}}),[]);return p.a.createElement(E,{label:t?i:o,icon:t?d.j:d.k,disabled:l,onClick:n,menuItems:O,onMenuItemClick:function(e){var t=j.find((function(t){return t.label===e.label}));t&&a&&a(t)},className:s,popoverContainerClassName:u,popoverTriggerBtnClassName:h,popoverTriggerBtnSeparatorClassName:b})},w=function(e){var t=e.room,n=e.enableScreenShare,a=e.enableAudio,r=e.enableVideo,i=e.onLeave,c=S(t.localParticipant).cameraPublication;void 0===n&&(n=!0),void 0===r&&(r=!0),void 0===a&&(a=!0);var o,s=p.a.useState(!1),l=s[0],u=s[1];if(a){var v=t.localParticipant.isMicrophoneEnabled;o=p.a.createElement(O,{isMuted:!v,isButtonDisabled:l,onClick:function(){try{return u(!0),t.localParticipant.setMicrophoneEnabled(!v),u(!1),Promise.resolve()}catch(e){return Promise.reject(e)}},onSourceSelected:function(e){try{return u(!0),Promise.resolve(t.switchActiveDevice("audioinput",e.deviceId)).then((function(){u(!1)}))}catch(n){return Promise.reject(n)}}})}var m,h=p.a.useState(!1),b=h[0],f=h[1];if(r){var j,g=!(null==(j=null===c||void 0===c?void 0:c.isMuted)||j);m=p.a.createElement(N,{isEnabled:g,isButtonDisabled:b,onClick:function(){try{return f(!0),Promise.resolve(t.localParticipant.setCameraEnabled(!g)).then((function(){f(!1)}))}catch(e){return Promise.reject(e)}},onSourceSelected:function(e){try{return f(!0),Promise.resolve(t.switchActiveDevice("videoinput",e.deviceId)).then((function(){f(!1)}))}catch(n){return Promise.reject(n)}}})}var y,x=p.a.useState(!1),C=x[0],P=x[1];if(n){var T=t.localParticipant.isScreenShareEnabled;y=p.a.createElement(E,{label:T?"Stop sharing":"Share screen",icon:T?d.g:d.c,disabled:C,onClick:function(){try{return P(!0),Promise.resolve(t.localParticipant.setScreenShareEnabled(!T)).then((function(){P(!1)}))}catch(e){return Promise.reject(e)}}})}return p.a.createElement("div",{className:k.controlsWrapper},o,m,y,i&&p.a.createElement(E,{label:"End",className:k.dangerButton,onClick:function(){t.disconnect(),i(t)}}))},L=p.a.createContext({stageLayout:"grid",showStats:!1});function M(){return M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},M.apply(this,arguments)}function R(e){return Object(m.createElement)("svg",M({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),y||(y=Object(m.createElement)("path",{d:"M0 6h2v3H0V6z",fill:"#981010"})),x||(x=Object(m.createElement)("path",{d:"M3.5 3h2v6h-2V3zM7 0h2v9H7V0z",fill:"#1A1B1D"})))}function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_.apply(this,arguments)}function I(e){return Object(m.createElement)("svg",_({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),C||(C=Object(m.createElement)("path",{d:"M0 6h2v3H0V6zM3.5 3h2v6h-2V3z",fill:"#F89C13"})),P||(P=Object(m.createElement)("path",{d:"M7 0h2v9H7V0z",fill:"#1A1B1D"})))}function D(){return D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},D.apply(this,arguments)}function A(e){return Object(m.createElement)("svg",D({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),T||(T=Object(m.createElement)("path",{d:"M0 6h2v3H0V6zM3.5 3h2v6h-2V3zM7 0h2v9H7V0z",fill:"#28994E"})))}var B=function(e){var t,n=e.track,a=e.isLocal,r=e.objectFit,i=e.className,c=e.onSizeChanged,o=e.width,s=e.height,l=Object(m.useRef)(null);Object(m.useEffect)((function(){var e=l.current;if(e)return e.muted=!0,n.attach(e),function(){n.detach(e)}}),[n,l]);var u=Object(m.useCallback)((function(e){e.target instanceof HTMLVideoElement&&c&&c(e.target.videoWidth,e.target.videoHeight)}),[]);Object(m.useEffect)((function(){var e=l.current;return e&&e.addEventListener("resize",u),function(){null===e||void 0===e||e.removeEventListener("resize",u)}}),[l]);var d="environment"!==(null===(t=n.mediaStreamTrack)||void 0===t?void 0:t.getSettings().facingMode),v={transform:a&&d?"rotateY(180deg)":"",width:o,height:s};return r&&(v.objectFit=r),p.a.createElement("video",{ref:l,className:null!=i?i:k.video,style:v})},z=function(e){var t=e.participant,n=e.width,a=e.height,r=e.className,i=e.speakerClassName,c=e.aspectWidth,o=e.aspectHeight,s=e.orientation,l=e.displayName,u=e.showOverlay,b=e.showConnectionQuality,j=e.onMouseEnter,g=e.onMouseLeave,E=e.onClick,O=S(t),y=O.cameraPublication,x=O.isLocal,C=O.connectionQuality,P=O.isSpeaking,T=Object(m.useState)(),N=T[0],w=T[1],M=Object(m.useState)(),_=M[0],D=M[1],z=Object(m.useContext)(L),V=Object(m.useCallback)((function(e,t){w(e+"x"+t)}),[]);Object(m.useEffect)((function(){var e=setInterval((function(){var e=0;t.tracks.forEach((function(t){(t.track instanceof v.LocalTrack||t.track instanceof v.RemoteTrack)&&(e+=t.track.currentBitrate)})),D(e)}),1e3);return function(){clearInterval(e)}}),[]);var U,Q,H={width:n,height:a},K="contain";!s&&c&&o&&(s=c>o?"landscape":"portrait"),null!==y&&void 0!==y&&y.dimensions&&(U=y.dimensions.width>y.dimensions.height?"landscape":"portrait"),U===s&&(K="cover"),l||(l=t.name||t.identity,x&&(l+=" (You)")),Q=null===y||void 0===y||!y.isSubscribed||null===y||void 0===y||!y.track||null!==y&&void 0!==y&&y.isMuted?p.a.createElement("div",{className:k.placeholder}):p.a.createElement(B,{track:y.track,isLocal:x,objectFit:K,width:"100%",height:"100%",onSizeChanged:V});var W=[k.participant];r&&W.push(r),P&&W.push(null!=i?i:k.speaker);var F,X,q=!t.isMicrophoneEnabled;if(z.showStats&&(F=p.a.createElement("div",{className:k.stats},p.a.createElement("span",null,N),void 0!==_&&_>0&&p.a.createElement("span",null,"\xa0",Math.round(_/1024)," kbps"))),b)switch(C){case v.ConnectionQuality.Excellent:X=A;break;case v.ConnectionQuality.Good:X=I;break;case v.ConnectionQuality.Poor:X=R}return p.a.createElement("div",{className:W.join(" "),style:H,onMouseEnter:j,onMouseLeave:g,onClick:E},c&&o&&p.a.createElement(f.AspectRatio,{ratio:c/o},Q),(!c||!o)&&Q,(u||z.showStats)&&p.a.createElement("div",{className:k.participantBar},p.a.createElement("div",{className:k.name},l),p.a.createElement("div",{className:k.center},F),p.a.createElement("div",null,X&&p.a.createElement(X,null)),p.a.createElement("div",null,p.a.createElement(h.a,{icon:q?d.e:d.d,height:24,className:q?k.iconRed:k.iconNormal}))))},V=function(e){var t=e.track,n=e.width,a=e.height;return p.a.createElement("div",{className:k.screenShare},p.a.createElement(B,{track:t,isLocal:!1,width:n,height:a}))};function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var H="_2sm4e",K="_2VE66",W="_2kKDi",F="_gA0MQ",X="_1smc2",q="_2HbZ0",G="_2ltyS",J="_2vumQ",Y="_X-1Rk",Z="_3rLR0",$="_3qF9s",ee="_mDdNR",te=function(e){var t=e.roomState,n=e.participantRenderer,a=e.controlRenderer,r=e.onLeave,i=t.isConnecting,c=t.error,o=t.participants,s=t.room,l=Object(m.useState)([]),u=l[0],d=l[1],v=Object(m.useState)(!1),h=v[0],b=v[1],f=p.a.useState(G),j=f[0],g=f[1];if(Object(m.useEffect)((function(){var e,t=1;1===o.length?g(G):2===o.length?(g(J),t=2):o.length<=4?(g(Y),t=Math.min(o.length,4)):o.length<=9?(g(Z),t=Math.min(o.length,9)):o.length<=16?(g($),t=Math.min(o.length,16)):(g(ee),t=Math.min(o.length,25));var n=[];u.forEach((function(e){(null!==s&&void 0!==s&&s.participants.has(e.sid)||(null===s||void 0===s?void 0:s.localParticipant.sid)===e.sid)&&n.push(e)})),null===s||void 0===s||null===(e=s.activeSpeakers)||void 0===e||e.forEach((function(e){if(!n.includes(e)&&(e===(null===s||void 0===s?void 0:s.localParticipant)||null!==s&&void 0!==s&&s.participants.has(e.sid))){var t=n.findIndex((function(e){return!e.isSpeaking}));t>=0?n[t]=e:n.push(e)}}));for(var a,r=Q(o);!(a=r()).done;){var i=a.value;if(n.length>=t)break;n.includes(i)||i.isSpeaking||n.push(i)}n.length>t&&n.splice(t,n.length-t),d(n)}),[o]),c)return p.a.createElement("div",null,"error ",c.message);if(i)return p.a.createElement("div",null,"connecting");if(!s)return p.a.createElement("div",null,"room closed");if(0===o.length)return p.a.createElement("div",null,"no one is in the room");var k=null!=n?n:z,E=null!=a?a:w;return p.a.createElement("div",{className:H},p.a.createElement("div",{className:q+" "+j},u.map((function(e){return p.a.createElement(k,{key:e.identity,participant:e,orientation:"landscape",width:"100%",height:"100%",showOverlay:h,showConnectionQuality:!0,onMouseEnter:function(){return b(!0)},onMouseLeave:function(){return b(!1)}})}))),p.a.createElement("div",{className:X},p.a.createElement(E,{room:s,onLeave:r})))},ne=function(e){var t=e.roomState,n=e.participantRenderer,a=e.controlRenderer,r=e.onLeave,i=t.isConnecting,c=t.error,o=t.participants,s=t.room,l=Object(m.useState)(!1),u=l[0],d=l[1];if(c)return p.a.createElement("div",null,"error ",c.message);if(i)return p.a.createElement("div",null,"connecting");if(!s)return p.a.createElement("div",null,"room closed");if(0===o.length)return p.a.createElement("div",null,"no one is in the room");var h,b=null!=n?n:z,f=null!=a?a:w;o.forEach((function(e){if(!h){var t=e.getTrack(v.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(h=t.videoTrack)}}));var j,g=o;return j=h?p.a.createElement(V,{track:h,height:"100%",width:"100%"}):p.a.createElement(b,{key:o[0].identity,participant:o[0],width:"100%",height:"100%",orientation:"landscape",showOverlay:u,showConnectionQuality:!0,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}}),p.a.createElement("div",{className:H},p.a.createElement("div",{className:K},p.a.createElement("div",{className:W},j),p.a.createElement("div",{className:F},g.map((function(e){return p.a.createElement(b,{key:e.identity,participant:e,width:"100%",aspectWidth:16,aspectHeight:9,showOverlay:u,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}})})))),p.a.createElement("div",{className:X},p.a.createElement(f,{room:s,onLeave:r})))},ae="_2zM8F",re="_9PXrI",ie="_Tl5ht",ce="_jGXiG",oe="_3MB5b",se=function(e){var t=e.roomState,n=e.participantRenderer,a=e.controlRenderer,r=e.onLeave,i=t.isConnecting,c=t.error,o=t.participants,s=t.room,l=Object(m.useState)(!1),u=l[0],d=l[1];if(c)return p.a.createElement("div",null,"error ",c.message);if(i)return p.a.createElement("div",null,"connecting");if(!s)return p.a.createElement("div",null,"room closed");if(0===o.length)return p.a.createElement("div",null,"no one is in the room");var h,b=null!=n?n:z,f=null!=a?a:w;o.forEach((function(e){if(!h){var t=e.getTrack(v.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(h=t.videoTrack)}}));var j,g=o;return j=h?p.a.createElement(V,{track:h,height:"100%",width:"100%"}):p.a.createElement(b,{key:o[0].identity,participant:o[0],showOverlay:u,width:"100%",height:"100%",orientation:"portrait",showConnectionQuality:!0,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}}),p.a.createElement("div",{className:ae},p.a.createElement("div",{className:re},j),p.a.createElement("div",{className:ie},g.map((function(e){return p.a.createElement(b,{key:e.identity,participant:e,className:ce,aspectWidth:4,aspectHeight:3,showOverlay:u,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}})}))),p.a.createElement("div",{className:oe},p.a.createElement(f,{room:s,enableScreenShare:!1,onLeave:r})))},le=function(e){var t,n,a=Object(j.useMediaQuery)({query:"(max-width: 800px)"}),r=e.roomState,i=r.room,c=r.participants,o=Object(m.useContext)(L);a?t=p.a.createElement(se,Object.assign({},e)):(c.forEach((function(e){if(!n){var t=e.getTrack(v.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(n=t.videoTrack)}})),t="grid"===o.stageLayout&&void 0===n?p.a.createElement(te,Object.assign({},e)):p.a.createElement(ne,Object.assign({},e)));return p.a.createElement("div",{className:k.container},t,e.roomState.audioTracks.map((function(e){return p.a.createElement(g,{key:e.sid,track:e,isLocal:!1})})),!1===(null===i||void 0===i?void 0:i.canPlaybackAudio)&&p.a.createElement("div",{className:k.overlay},p.a.createElement("button",{className:k.unmuteButton,onClick:function(){i.startAudio()}},p.a.createElement(h.a,{className:k.icon,size:"1x",icon:d.l}),"Click to Unmute")))};"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function ue(e,t){if(e.sort((function(e,t){var n,a,r,i;if(e.isSpeaking&&t.isSpeaking)return t.audioLevel-e.audioLevel;if(e.isSpeaking!==t.isSpeaking)return e.isSpeaking?-1:1;if(e.lastSpokeAt!==t.lastSpokeAt){var c,o,s,l,u=null!=(c=null===(o=e.lastSpokeAt)||void 0===o?void 0:o.getTime())?c:0;return(null!=(s=null===(l=t.lastSpokeAt)||void 0===l?void 0:l.getTime())?s:0)-u}var d=e.videoTracks.size>0;return d!==t.videoTracks.size>0?d?-1:1:(null!=(n=null===(a=e.joinedAt)||void 0===a?void 0:a.getTime())?n:0)-(null!=(r=null===(i=t.joinedAt)||void 0===i?void 0:i.getTime())?r:0)})),t){var n=e.indexOf(t);n>=0&&(e.splice(n,1),e.length>0?e.splice(1,0,t):e.push(t))}}var de=function(e){var t=e.url,n=e.token,a=e.connectOptions,r=e.sortParticipants,i=e.stageRenderer,c=e.participantRenderer,o=e.controlRenderer,s=e.onConnected,l=e.onLeave,u=function(e){var t,n=Object(m.useState)(),a=n[0],r=n[1],i=Object(m.useState)(!1),c=i[0],o=i[1],s=Object(m.useState)(),l=s[0],u=s[1],d=Object(m.useState)([]),p=d[0],h=d[1],b=Object(m.useState)([]),f=b[0],j=b[1],g=null!=(t=null===e||void 0===e?void 0:e.sortParticipants)?t:ue,k=Object(m.useCallback)((function(e,t,n){try{return o(!0),Promise.resolve(function(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}((function(){return Promise.resolve(Object(v.connect)(e,t,n)).then((function(e){r(e);var t=function(){var t=Array.from(e.participants.values()),n=[e.localParticipant];n.push.apply(n,t),g(n,e.localParticipant),h(n)},n=function(n){if(t(),!n||n.kind===v.Track.Kind.Audio){var a=[];e.participants.forEach((function(e){e.audioTracks.forEach((function(e){e.audioTrack&&a.push(e.audioTrack)}))})),j(a)}};return e.once(v.RoomEvent.Disconnected,(function(){setTimeout((function(){return r(void 0)})),e.off(v.RoomEvent.ParticipantConnected,t).off(v.RoomEvent.ParticipantDisconnected,t).off(v.RoomEvent.ActiveSpeakersChanged,t).off(v.RoomEvent.TrackSubscribed,n).off(v.RoomEvent.TrackUnsubscribed,n).off(v.RoomEvent.LocalTrackPublished,t).off(v.RoomEvent.LocalTrackUnpublished,t).off(v.RoomEvent.AudioPlaybackStatusChanged,t)})),e.on(v.RoomEvent.ParticipantConnected,t).on(v.RoomEvent.ParticipantDisconnected,t).on(v.RoomEvent.ActiveSpeakersChanged,t).on(v.RoomEvent.TrackSubscribed,n).on(v.RoomEvent.TrackUnsubscribed,n).on(v.RoomEvent.LocalTrackPublished,t).on(v.RoomEvent.LocalTrackUnpublished,t).on(v.RoomEvent.AudioPlaybackStatusChanged,t),o(!1),n(),e}))}),(function(e){o(!1),e instanceof Error?u(e):u(new Error("an error has occured"))})))}catch(a){return Promise.reject(a)}}),[]);return{connect:k,isConnecting:c,room:a,error:l,participants:p,audioTracks:f}}({sortParticipants:r});return a||(a={}),Object(m.useEffect)((function(){u.connect(t,n,a).then((function(e){if(e)return s&&s(e),function(){e.disconnect()}}))}),[]),(null!=i?i:le)({roomState:u,participantRenderer:c,controlRenderer:o,onLeave:l})},ve=n(85),me=n(1),pe=function(){var e=Object(m.useState)("ws://localhost:7880"),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(m.useState)(""),i=Object(s.a)(r,2),l=i[0],p=i[1],h=Object(m.useState)(!0),b=Object(s.a)(h,2),f=b[0],j=b[1],g=Object(m.useState)(!0),k=Object(s.a)(g,2),S=k[0],y=k[1],x=Object(m.useState)(!0),C=Object(s.a)(x,2),P=C[0],T=C[1],w=Object(m.useState)(!1),L=Object(s.a)(w,2),M=L[0],R=L[1],_=Object(m.useState)(!0),I=Object(s.a)(_,2),D=I[0],A=I[1],z=Object(m.useState)(!0),V=Object(s.a)(z,2),U=V[0],Q=V[1],H=Object(m.useState)(),K=Object(s.a)(H,2),W=K[0],F=K[1],X=Object(m.useState)(),q=Object(s.a)(X,2),G=q[0],J=q[1],Y=Object(m.useState)(),Z=Object(s.a)(Y,2),$=Z[0],ee=Z[1],te=Object(c.f)();Object(m.useEffect)((function(){Q(!l||!n)}),[l,n]);var ne=function(){var e=Object(o.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=6;break}W.stop(),R(!1),F(void 0),e.next=11;break;case 6:return e.next=8,Object(v.createLocalVideoTrack)({deviceId:null===$||void 0===$?void 0:$.deviceId});case 8:t=e.sent,R(!0),F(t);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(m.useEffect)((function(){Object(v.createLocalVideoTrack)({deviceId:null===$||void 0===$?void 0:$.deviceId}).then((function(e){R(!0),F(e)}))}),[$]);var ae,re=function(){var e=Object(o.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W&&W.stop(),"https:"!==window.location.protocol||!n.startsWith("ws://")||n.startsWith("ws://localhost")){e.next=4;break}return alert("Unable to connect to insecure websocket from https"),e.abrupt("return");case 4:if(t={url:n,token:l,videoEnabled:M?"1":"0",audioEnabled:D?"1":"0",simulcast:f?"1":"0",dynacast:S?"1":"0",adaptiveStream:P?"1":"0"},G&&(t.audioDeviceId=G.deviceId),!$){e.next=10;break}t.videoDeviceId=$.deviceId,e.next=15;break;case 10:if(!W){e.next=15;break}return e.next=13,W.getDeviceId();case 13:(a=e.sent)&&(t.videoDeviceId=a);case 15:te.push({pathname:"/room",search:"?"+new URLSearchParams(t).toString()});case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return ae=W?Object(me.jsx)(B,{track:W,isLocal:!0}):Object(me.jsx)("div",{className:"placeholder"}),Object(me.jsxs)("div",{className:"prejoin",children:[Object(me.jsxs)("main",{children:[Object(me.jsx)("h2",{children:"LiveKit Video"}),Object(me.jsx)("hr",{}),Object(me.jsxs)("div",{className:"entrySection",children:[Object(me.jsxs)("div",{children:[Object(me.jsx)("div",{className:"label",children:"LiveKit URL"}),Object(me.jsx)("div",{children:Object(me.jsx)("input",{type:"text",name:"url",value:n,onChange:function(e){return a(e.target.value)}})})]}),Object(me.jsxs)("div",{children:[Object(me.jsx)("div",{className:"label",children:"Token"}),Object(me.jsx)("div",{children:Object(me.jsx)("input",{type:"text",name:"token",value:l,onChange:function(e){return p(e.target.value)}})})]}),Object(me.jsxs)("div",{className:"options",children:[Object(me.jsxs)("div",{children:[Object(me.jsx)("input",{id:"simulcast-option",type:"checkbox",name:"simulcast",checked:f,onChange:function(e){return j(e.target.checked)}}),Object(me.jsx)("label",{htmlFor:"simulcast-option",children:"Simulcast"})]}),Object(me.jsxs)("div",{children:[Object(me.jsx)("input",{id:"dynacast-option",type:"checkbox",name:"dynacast",checked:S,onChange:function(e){return y(e.target.checked)}}),Object(me.jsx)("label",{htmlFor:"dynacast-option",children:"Dynacast"})]}),Object(me.jsxs)("div",{children:[Object(me.jsx)("input",{id:"adaptivestream-option",type:"checkbox",name:"adaptiveStream",checked:P,onChange:function(e){return T(e.target.checked)}}),Object(me.jsx)("label",{htmlFor:"adaptivestream-option",children:"Adaptive Stream"})]})]})]}),Object(me.jsx)("div",{className:"videoSection",children:Object(me.jsx)(ve.AspectRatio,{ratio:16/9,children:ae})}),Object(me.jsxs)("div",{className:"controlSection",children:[Object(me.jsxs)("div",{children:[Object(me.jsx)(O,{isMuted:!D,onClick:function(){A(!D)},onSourceSelected:J}),Object(me.jsx)(N,{isEnabled:void 0!==W,onClick:ne,onSourceSelected:function(e){if(ee(e),W){if(W.mediaStreamTrack.getSettings().deviceId===e.deviceId)return;W.stop()}}})]}),Object(me.jsx)("div",{className:"right",children:Object(me.jsx)(E,{label:"Connect",disabled:U,icon:d.a,onClick:re})})]})]}),Object(me.jsxs)("footer",{children:["This page is built with ",Object(me.jsx)("a",{href:"https://github.com/livekit/livekit-react",children:"LiveKit React"}),"\xa0 (",Object(me.jsx)("a",{href:"https://github.com/livekit/livekit-react/blob/master/example/src/PreJoinPage.tsx",children:"source"}),")"]})]})},he=n(61),be=n(46),fe=(n(144),function(){var e=Object(m.useState)(0),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(m.useState)({stageLayout:"grid",showStats:!1}),i=Object(s.a)(r,2),o=i[0],l=i[1],u=Object(c.f)(),p=new URLSearchParams(Object(c.g)().search),h=p.get("url"),b=p.get("token"),f=p.get("recorder");if(!h||!b)return Object(me.jsx)("div",{children:"url and token are required"});var j=function(e){a(e.participants.size+1)},g=function(e){l(Object(he.a)(Object(he.a)({},o),e))};return Object(me.jsx)(L.Provider,{value:o,children:Object(me.jsxs)("div",{className:"roomContainer",children:[Object(me.jsxs)("div",{className:"topBar",children:[Object(me.jsx)("h2",{children:"LiveKit Video"}),Object(me.jsxs)("div",{className:"right",children:[Object(me.jsxs)("div",{children:[Object(me.jsx)("input",{id:"showStats",type:"checkbox",onChange:function(e){return g({showStats:e.target.checked})}}),Object(me.jsx)("label",{htmlFor:"showStats",children:"Show Stats"})]}),Object(me.jsxs)("div",{children:[Object(me.jsx)("button",{className:"iconButton",disabled:"grid"===o.stageLayout,onClick:function(){g({stageLayout:"grid"})},children:Object(me.jsx)(be.a,{height:32,icon:d.h})}),Object(me.jsx)("button",{className:"iconButton",disabled:"speaker"===o.stageLayout,onClick:function(){g({stageLayout:"speaker"})},children:Object(me.jsx)(be.a,{height:32,icon:d.f})})]}),Object(me.jsxs)("div",{className:"participantCount",children:[Object(me.jsx)(be.a,{icon:d.i}),Object(me.jsx)("span",{children:n})]})]})]}),Object(me.jsx)(de,{url:h,token:b,onConnected:function(e){!function(e,t){je.apply(this,arguments)}(e,p),e.on(v.RoomEvent.ParticipantConnected,(function(){return j(e)})),e.on(v.RoomEvent.ParticipantDisconnected,(function(){return function(e){j(e),f&&1===parseInt(f,10)&&0===e.participants.size&&console.log("END_RECORDING")}(e)})),j(e)},connectOptions:{adaptiveStream:ge(p,"adaptiveStream"),dynacast:ge(p,"dynacast"),videoCaptureDefaults:{resolution:v.VideoPresets.h720.resolution},logLevel:"debug"},onLeave:function(){u.push({pathname:"/"})}})]})})});function je(){return(je=Object(o.a)(u.a.mark((function e(t,n){var a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.currentRoom=t,!ge(n,"audioEnabled")){e.next=6;break}return(a=n.get("audioDeviceId"))&&t.options.audioCaptureDefaults&&(t.options.audioCaptureDefaults.deviceId=a),e.next=6,t.localParticipant.setMicrophoneEnabled(!0);case 6:if(!ge(n,"videoEnabled")){e.next=11;break}return(r=n.get("videoDeviceId"))&&t.options.videoCaptureDefaults&&(t.options.videoCaptureDefaults.deviceId=r),e.next=11,t.localParticipant.setCameraEnabled(!0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t){return"1"===e.get(t)||"true"===e.get(t)}var ke=function(){return Object(me.jsx)("div",{className:"container",children:Object(me.jsx)(i.a,{children:Object(me.jsxs)(c.c,{children:[Object(me.jsx)(c.a,{path:"/room",children:Object(me.jsx)(fe,{})}),Object(me.jsx)(c.a,{path:"/",children:Object(me.jsx)(pe,{})})]})})})};n(145);r.a.render(Object(me.jsx)(ke,{}),document.getElementById("root"))},90:function(e,t,n){}},[[147,1,2]]]);
//# sourceMappingURL=main.0d140e59.chunk.js.map